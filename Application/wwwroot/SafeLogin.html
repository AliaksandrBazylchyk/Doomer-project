<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/styles.css">
    <title>Safe Login</title>
</head>
<body>
    <div class="container">
        <h1>SafeLogin</h1>
        <input type="hidden" id="userId" />
        <p class="pl1">
            Login:<br />
        </p>
        <input class="namel" id="userName" />
        <p class="pl2">
            Password:<br />
        </p>
        <input class="namel" id="userPassword" type="password" />
        <div class="lbuttons">
            <button id="saveBtn">Login</button>
            <button id="resetBtn">Delete</button>
            <input class="button btn" value="Registration" type="button" onclick="Back()" />
        </div>
    </div>

        <table>
            <tbody>
            </tbody>
        </table>

        <script>
            async function isSession() {
                const response = await fetch("https://localhost:7249/api/Main/isSession", {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });
                if (response.ok === true) {
                    if (await response.json() == true) {
                        location.href = 'WelcomePage.html';
                    }
                }
            }
            isSession();
            async function LoginUser(userName, userPassword) {

                const response = await fetch("https://localhost:7249/api/Main/safelogin", {
                    method: "POST",
                    headers: { "Accept": "application/json", "Content-Type": "application/json" },
                    body: JSON.stringify({
                        name: userName,
                        password: userPassword
                    })
                });
                if (response.ok === true) {
                    const user = await response.json();

                }
                else {
                    const error = await response.json();
                    console.log(error.message);
                }
                location.href = 'WelcomePage.html';
            }
            function reset() {
                document.getElementById("userId").value =
                    document.getElementById("userName").value =
                    document.getElementById("userPassword").value = "";
            }
            document.getElementById("resetBtn").addEventListener("click", () => reset());

            document.getElementById("saveBtn").addEventListener("click", async () => {

                const name = document.getElementById("userName").value;
                const password = document.getElementById("userPassword").value;
                await LoginUser(name, password);
                reset();
            });

            function Back() {
                location.href = 'Index';
            }
        </script>
</body>
</html>
